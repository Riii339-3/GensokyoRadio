<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Favorite Player</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #2b0631;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
        }

        .player {
            text-align: center;
            margin-top: 20px;
        }

        .album-art {
            width: 100%;
            max-width: 300px;
            border-radius: 10px;
        }

        .info {
            margin-top: 15px;
        }

        .controls {
            margin-top: 20px;
        }

        button {
            background-color: #a84fb0;
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        button:disabled {
            background-color: #4b1662;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="player">
        <img id="albumArt" class="album-art" src="" alt="Album Art">
        <div class="info">
            <div id="title" class="title">No song playing</div>
            <div id="artist" class="artist">Add some favorites to get started</div>
        </div>
        <div class="controls">
            <button onclick="previousTrack()">‚èÆÔ∏è Previous</button>
            <button onclick="togglePlay()">‚ñ∂Ô∏è Play</button>
            <button onclick="nextTrack()">‚è≠Ô∏è Next</button>
            <button onclick="toggleLoop()">üîÅ Loop: Off</button>
            <button onclick="toggleShuffle()">üîÄ Shuffle: Off</button>
            <a href="index.html"><button>Back to Main</button></a>
        </div>
    </div>

    <audio id="audioPlayer" hidden></audio>

    <script>
        const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
        let currentIndex = 0;
        let isPlaying = false;
        let loopMode = 'none'; // 'none', 'one', 'all'
        let shuffle = false;

        const audioPlayer = document.getElementById('audioPlayer');
        const albumArt = document.getElementById('albumArt');
        const title = document.getElementById('title');
        const artist = document.getElementById('artist');

        // ÂàùÊúü„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø
        function loadTrack(index) {
            if (favorites.length === 0) {
                title.textContent = 'No song playing';
                artist.textContent = 'Add some favorites to get started';
                albumArt.src = '';
                audioPlayer.src = '';
                return;
            }

            const track = favorites[index];
            title.textContent = track.title;
            artist.textContent = track.artist;
            albumArt.src = track.albumArt;
            audioPlayer.src = track.streamUrl;
        }

        // ÂÜçÁîü/‰∏ÄÊôÇÂÅúÊ≠¢„ÅÆÂàá„ÇäÊõø„Åà
        function togglePlay() {
            if (!audioPlayer.src) return;

            if (isPlaying) {
                audioPlayer.pause();
                isPlaying = false;
                document.querySelector('button[onclick="togglePlay()"]').textContent = '‚ñ∂Ô∏è Play';
            } else {
                audioPlayer.play();
                isPlaying = true;
                document.querySelector('button[onclick="togglePlay()"]').textContent = '‚è∏Ô∏è Pause';
            }
        }

        // Ê¨°„ÅÆ„Éà„É©„ÉÉ„ÇØ„ÇíÂÜçÁîü
        function nextTrack() {
            if (shuffle) {
                currentIndex = Math.floor(Math.random() * favorites.length);
            } else {
                currentIndex = (currentIndex + 1) % favorites.length;
            }

            if (loopMode === 'one') {
                // ‰∏ÄÊõ≤„É´„Éº„Éó„ÅÆÂ†¥Âêà„ÄÅÁèæÂú®„ÅÆ„Éà„É©„ÉÉ„ÇØ„ÇíÂÜçÁîü„ÅóÁ∂ö„Åë„Çã
                audioPlayer.currentTime = 0;
            } else {
                loadTrack(currentIndex);
                if (isPlaying) audioPlayer.play();
            }
        }

        // Ââç„ÅÆ„Éà„É©„ÉÉ„ÇØ„ÇíÂÜçÁîü
        function previousTrack() {
            if (shuffle) {
                currentIndex = Math.floor(Math.random() * favorites.length);
            } else {
                currentIndex = (currentIndex - 1 + favorites.length) % favorites.length;
            }

            loadTrack(currentIndex);
            if (isPlaying) audioPlayer.play();
        }

        // „É´„Éº„Éó„É¢„Éº„Éâ„ÅÆÂàá„ÇäÊõø„Åà
        function toggleLoop() {
            if (loopMode === 'none') {
                loopMode = 'all';
                document.querySelector('button[onclick="toggleLoop()"]').textContent = 'üîÅ Loop: All';
            } else if (loopMode === 'all') {
                loopMode = 'one';
                document.querySelector('button[onclick="toggleLoop()"]').textContent = 'üîÅ Loop: One';
            } else {
                loopMode = 'none';
                document.querySelector('button[onclick="toggleLoop()"]').textContent = 'üîÅ Loop: Off';
            }
        }

        // „Ç∑„É£„ÉÉ„Éï„É´„ÅÆÂàá„ÇäÊõø„Åà
        function toggleShuffle() {
            shuffle = !shuffle;
            document.querySelector('button[onclick="toggleShuffle()"]').textContent = shuffle
                ? 'üîÄ Shuffle: On'
                : 'üîÄ Shuffle: Off';
        }

        // Êõ≤„ÅåÁµÇ„Çè„Å£„Åü„Å®„Åç„ÅÆÂá¶ÁêÜ
        audioPlayer.addEventListener('ended', () => {
            if (loopMode === 'one') {
                audioPlayer.currentTime = 0;
                audioPlayer.play();
            } else if (loopMode === 'all') {
                nextTrack();
            } else if (shuffle) {
                currentIndex = Math.floor(Math.random() * favorites.length);
                loadTrack(currentIndex);
                if (isPlaying) audioPlayer.play();
            } else {
                currentIndex = (currentIndex + 1) % favorites.length;
                if (currentIndex === 0) {
                    isPlaying = false;
                    document.querySelector('button[onclick="togglePlay()"]').textContent = '‚ñ∂Ô∏è Play';
                } else {
                    loadTrack(currentIndex);
                    if (isPlaying) audioPlayer.play();
                }
            }
        });

        // ÂàùÊúüÂåñ
        loadTrack(currentIndex);
    </script>
</body>
</html>
